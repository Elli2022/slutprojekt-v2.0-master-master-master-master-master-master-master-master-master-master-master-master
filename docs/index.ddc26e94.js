const e={imageSelection:document.getElementById("image-selection"),createAccountButton:document.getElementById("create-account-button"),submitButton:document.getElementById("submit-button"),usernameInput:document.getElementById("username"),passwordInput:document.getElementById("password"),form:document.getElementById("form"),errorMessage:document.createElement("p"),userDeletedSuccessfully:document.createElement("h1"),failedToDeleteUser:document.createElement("h1"),messageInput:document.createElement("input"),listItem:document.createElement("li"),body:document.getElementById("body"),accountCreated:document.createElement("h1"),logInpage:document.getElementById("logInpage"),container:document.getElementById("container"),currentUser:document.getElementById("current-user"),statusUpdates:document.getElementById("status-updates"),newStatusUpdate:document.getElementById("new-status-update"),addStatusUpdate:document.getElementById("add-status-update"),loggedInUsersList:document.querySelector(".js-logged-in-users-list"),otherUserPageHeader:document.querySelector(".js-other-user-page-header"),deleteAccount:document.getElementById("delete-account"),deleteAccountButton:document.getElementById("delete-account-button"),statusInput:document.getElementById("status-input"),statusUpdateButton:document.getElementById("status-update-button"),otherUserPage:document.getElementById("other-user-page"),loggedInUsersPage:document.getElementById("logged-in-users-page"),statusUpdatesList:document.getElementById("status-updates-list"),submitStatus:document.getElementById("submit-status"),allUsersList:document.getElementById("allUsersList"),userStatus:document.getElementById("userStatus")};e.logInpage&&(e.logInpage.style.display="block"),e.container.style.display="none",e.body.appendChild(e.container);document.createElement("div").className="error-message";const t="https://social-media-68d76-default-rtdb.europe-west1.firebasedatabase.app/";async function s(){try{const e=await fetch(`${t}users.json`);if(!e.ok)throw new Error(`Error: ${e.status} ${e.statusText}`);const s=await e.json();if(!s)return[];return Object.values(s)}catch(e){throw new Error("Failed to fetch users")}}async function n(e){await s();const n=`${t}users/${e.userName}.json`,a={method:"PUT",body:JSON.stringify(e),headers:{"Content-type":"application/json; charset=UTF-8"}};try{const e=await fetch(n,a);if(!e.ok)throw new Error(`Error: ${e.status} ${e.statusText}`)}catch(e){throw console.log(e),new Error("Failed to save user information.")}}async function a(e){const s=`${t}users/${e}.json`,n={method:"DELETE"};try{const e=await fetch(s,n);if(!e.ok)throw new Error(`Error: ${e.status} ${e.statusText}`)}catch(e){throw console.log(e),new Error("Failed to delete user.")}}async function o(){const e=localStorage.getItem("loggedInUser");return e?await r(e):null}async function r(e){return(await s()).find((t=>t.userName===e))||null}async function u(){const t=e.usernameInput.value.trim(),a=e.passwordInput.value.trim();if(t&&a)try{const r=(await s()).find((e=>e.userName===t&&e.password===a));if(!r)return;r.newUser=!1,r.status="logged-in",await n(r),localStorage.setItem("loggedInUser",r.userName),e.allUsersList.style.display="block",e.logInpage.style.display="none",e.container.style.display="block",e.currentUser?e.currentUser.textContent=`Logged in as: ${r.userName}`:console.error("elements.currentUser is null"),async function(){const t=await s();await o();t.forEach((t=>{const s=document.createElement("li");s.textContent=`${t.userName}:`,e.loggedInUsersList&&e.loggedInUsersList.appendChild(s)}))}(),async function(){const t=await o();t&&(e.userStatus.textContent=`${t.userName}'s status: ${t.status}`)}()}catch(t){console.log(t),e.errorMessage.innerHTML="Failed to log in. Try again.",e.body.appendChild(e.errorMessage),setTimeout((()=>{e.errorMessage.remove()}),3e3)}else e.errorMessage.innerHTML="Please enter a username and password.",e.body.appendChild(e.errorMessage),setTimeout((()=>{e.errorMessage.remove()}),3e3);document.getElementById("logoutButton").style.display="block",document.getElementById("backButton").style.display="block",document.getElementById("delete-account-button").style.display="block"}async function l(){try{const t=await s(),n=document.createElement("ul");t.forEach((e=>{const t=document.createElement("li");t.classList.add("user-item");const s=e.statusUpdates&&e.statusUpdates.slice(-1)[0]||"",a=s.timestamp?new Date(s.timestamp):null,o=a?`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")} ${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}:${String(a.getSeconds()).padStart(2,"0")}`:"",u=document.createElement("img");u.src=e.imageurl,u.width=50,u.height=50,u.style.marginRight="5px";const l=document.createTextNode(`${e.userName} - Last status: ${s.status||"No status update yet"} ${o?`(${o})`:""}`);t.appendChild(u),t.appendChild(l),t.addEventListener("click",(()=>{!async function(e){const t=await r(e);if(!t)throw new Error("User not found.");const s=document.getElementById("container"),n=document.getElementById("otherUserPage");if(s&&n){s.style.display="none",n.style.display="block",n.querySelector(".username").textContent=t.userName,n.querySelector(".profile-pic").setAttribute("src",t.imageurl);const e=n.querySelector(".status-updates");if(e)if(e.innerHTML="",t.statusUpdates)t.statusUpdates.sort(((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime())),t.statusUpdates.forEach((t=>{const s=document.createElement("p"),n=new Date(t.timestamp),a=`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")} ${String(n.getHours()).padStart(2,"0")}:${String(n.getMinutes()).padStart(2,"0")}:${String(n.getSeconds()).padStart(2,"0")}`;s.textContent=`${a}: ${t.status}`,e.appendChild(s)}));else{const t=document.createElement("p");t.textContent="No status update yet.",e.appendChild(t)}else console.error("Error: statusUpdatesContainer element is missing.")}else console.error("Error: loggedInUsersPage or otherUserPage element is missing.")}(e.userName)})),n.appendChild(t)})),e.allUsersList&&(e.allUsersList.innerHTML="",e.allUsersList.appendChild(n))}catch(e){console.log(e.message)}}function d(){const e=document.getElementById("container"),t=document.getElementById("otherUserPage");if(e&&t){e.style.display="block",t.style.display="none";const s=document.getElementById("userListWrapper");s&&(s.style.display="block")}else console.error("Error: loggedInUsersPage or otherUserPage element is missing.")}async function c(){const t=e.usernameInput.value.trim(),n=e.passwordInput.value.trim();if(t&&n)try{const o=(await s()).find((e=>e.userName===t&&e.password===n));o?(await a(o.userName),localStorage.removeItem("loggedInUser"),e.userDeletedSuccessfully.innerHTML="User deleted successfully!",e.body.appendChild(e.userDeletedSuccessfully),setTimeout((()=>{e.userDeletedSuccessfully.remove()}),3e3),e.usernameInput.value="",e.passwordInput.value="",e.container.style.display="none",e.logInpage.style.display="block",await l()):(e.failedToDeleteUser.innerHTML="Failed to delete user. Incorrect username or password.",e.body.appendChild(e.failedToDeleteUser),setTimeout((()=>{e.failedToDeleteUser.remove()}),3e3))}catch(t){console.log(t),e.failedToDeleteUser.innerHTML="Failed to delete user. Try again.",e.body.appendChild(e.failedToDeleteUser),setTimeout((()=>{e.failedToDeleteUser.remove()}),3e3)}else e.errorMessage.innerHTML="Please enter a username and password.",e.body.appendChild(e.errorMessage),setTimeout((()=>{e.errorMessage.remove()}),3e3);e.container.style.display="none",e.logInpage.style.display="block"}function i(){console.log("Create Account Button: ",e.createAccountButton),console.log("Submit Button: ",e.submitButton),console.log("Delete Account Button: ",e.deleteAccountButton),console.log("Submit Status: ",e.submitStatus),e.createAccountButton.addEventListener("click",(()=>{!async function(){const t=e.usernameInput.value.trim(),s=e.passwordInput.value.trim(),a=e.imageSelection.value.trim();if(t&&s&&a)try{if(await r(t))return e.errorMessage.innerHTML="Username already exists. Please choose a different username.",e.body.appendChild(e.errorMessage),void setTimeout((()=>{e.errorMessage.remove()}),3e3);const o={userName:t,password:s,status:"",imageurl:a,newUser:!0,statusUpdates:[]};await n(o),e.accountCreated.innerHTML="Account Created! Now you can login!",e.body.appendChild(e.accountCreated),setTimeout((()=>{e.accountCreated.remove()}),3e3)}catch(t){console.log(t),e.errorMessage.innerHTML="Failed to create account. Try again.",e.body.appendChild(e.errorMessage),setTimeout((()=>{e.errorMessage.remove()}),3e3)}else e.errorMessage.innerHTML="Please fill in all fields.",e.body.appendChild(e.errorMessage),setTimeout((()=>{e.errorMessage.remove()}),3e3)}()})),e.submitButton.addEventListener("click",(e=>{e.preventDefault(),u()})),e.deleteAccountButton.addEventListener("click",(()=>{c()})),e.submitStatus.addEventListener("click",(t=>{t.preventDefault(),async function(){const t=e.statusInput.value.trim();if(t)try{const s=await o();if(s){s.statusUpdates||(s.statusUpdates=[]);const a=(new Date).toISOString();s.statusUpdates.push({status:t,timestamp:a}),await n(s),e.statusInput.value="",l()}else e.errorMessage.innerHTML="Failed to find the current user.",e.body.appendChild(e.errorMessage),setTimeout((()=>{e.errorMessage.remove()}),3e3)}catch(t){console.log(t),e.errorMessage.innerHTML="Failed to update status. Try again.",e.body.appendChild(e.errorMessage),setTimeout((()=>{e.errorMessage.remove()}),3e3)}else e.errorMessage.innerHTML="Please enter a status update.",e.body.appendChild(e.errorMessage),setTimeout((()=>{e.errorMessage.remove()}),3e3)}()}));const t=document.getElementById("backButton");t?t.addEventListener("click",d):console.error("Error: backButton element is missing.")}document.getElementById("logoutButton")?.addEventListener("click",(async function(){await async function(){const e=await o();e&&(e.status="logged-out",await n(e));localStorage.removeItem("loggedInUser")}(),window.location.href="/"})),async function(){document.addEventListener("DOMContentLoaded",(async()=>{i(),await l()}))}();
//# sourceMappingURL=index.ddc26e94.js.map
